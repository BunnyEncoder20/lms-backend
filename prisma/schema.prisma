// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Table Schemas
// User Table
model User {
  personalNumber        String    @id @unique
  firstName             String
  lastName              String
  email                 String?   @unique
  rank                  Rank
  role                  Role
  passwordHash          String
  refreshTokenHash      String?
  lastLoginAt           DateTime?
  failedLoginAttempts   Int       @default(0)
  lastPasswordChangeAt  DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  createdBy             String?
  updatedBy             String?
  isActive              Boolean   @default(true)
  deletedAt             DateTime?
}


// enums
enum Rank {
  VICE_ADMIRAL
  REAR_ADMIRAL
  COMODOR
  CAPTAIN
  COMMANDER
  LT_COMMANDER
  LT
  SUB_LT
}

enum Role {
  SUPER_ADMIN
  ADMIN
  TETRA_ADMIN
  CO
  JR_CO
  LMS_ADMIN
  OPERATOR
  TRAINER
  MAINTAINER
  TRAINEE
  ASSESSEE
}

// Trial schema for logging  

// Define an Enum for activity types for easy filtering and consistency
enum ActivityType {
  LOGIN
  LOGOUT
  RESOURCE_VIEW // Tracking access to LMS content (read, watch, etc.)
  RESOURCE_CREATE
  RESOURCE_UPDATE
  RESOURCE_DELETE
  USER_CREATE
  USER_UPDATE
  USER_DELETE
  SECURITY_VIOLATION // Failed login attempts, unauthorized access
  SYSTEM_ACCESS // General endpoint access
}

model AuditLog {
  id              String         @id @default(cuid()) // Unique ID for the log entry
  
  // Filtering & Sorting Fields
  createdAt       DateTime       @default(now()) @map("created_at") // Latest to oldest sorting (REQUIRED)
  activityType    ActivityType   @map("activity_type") // For filtering by activity (e.g., 'LOGIN', 'USER_UPDATE')

  // User Context (Key for User ID/Username filtering)
  personalNumber  String         @map("personal_number") // The User ID who initiated the action
  username        String?        // The user's name for easier readability

  // Request Context
  method          String         // HTTP method: GET, POST, PATCH, DELETE
  route           String         // The endpoint accessed: e.g., /v1/user/123456
  
  // Storage for complex data
  details         Json           // Stores IP, request body, query params, old/new values, error messages, etc. (REQUIRED)
  
  // Optional: Add an index for faster lookups on your most frequent query fields
  @@index([personalNumber])
  @@index([activityType])
  @@map("audit_log") // Set the table name
}
